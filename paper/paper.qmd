---
title: "Survival Compass"
subtitle: "Understanding the Impact of Pathologic Stage and Treatment Modalities on Lung Cancer Patients' Survival Post-Diagnosis."
author: 
  - Lexi Knight
thanks: "Code and data are available at: https://github.com/LexiKnight/Lung_Cancer/tree/main"
date: today
date-format: long 
abstract: "This study investigates the impact of pathologic stage and treatment modalities on lung cancer survival post-diagnosis. Analysis of patient data reveals significant correlation between the variables that make up pathologic stage, treatment type and survival outcomes. Notably, patients who demonstrate lower survival rates are those with advanced spread, extensive lymph node involvement and tumors with extensive growth into nearby structures. Additionally pharmaceutical therapy is shown to be more effective in prolonging patient survival times than radiation therapy. These findings underscore the critical importance of early detection, tailored treatment strategies and ongoing research efforts to enhance lung cancer survival rates globally."
format:
  pdf:
    toc: true
number-sections: true
bibliography: references.bib
---

# Introduction

Surviving lung cancer is a daunting challenge, where each breath marks a battle against a formidable adversary. As the leading cause of cancer-related deaths worldwide (Park et al.), lung cancer casts a shadow over millions of lives, demanding a nuanced understanding of its complexities. In this study, we explore the interplay between individual characteristics and survival outcomes, aiming to uncover the hidden determinants of victory against this relentless disease. Lung cancer manifests primarily in the airway linings of lung tissues, with non-small cell lung cancer (NSCLC) representing the predominant subtype according to the American Cancer Society [@Markman]. Staging is important for prognosis and making treatment decisions. Common treatments include surgery, radiation therapy and chemotherapy [@Kai]. Staging relies on tumor size, lymph node involvement, and the presence of distant metastasis [@Markman]. This paper investigates the relationship between lung cancer patients' survival, pathologic stage and treatment type. The estimand is the median survival time in days post-diagnosis. Through analysis of a data set made up of 382 patients in Sydney, Australia, we offer insight into the prognostic markers. 
 
Tumor size is often the main determinant of stage and treatment. As tumor categories increase, the tumor expands, invading nearby structures. A study involving 52,287 patients diagnosed between the years 1998 and 2003 found tumor size to be an independent prognostic factor in estimating overall survival and that larger tumors predicted a worse prognosis and  decreased survival [@Zhang]. Similarly, extensive lymph node involvement  and presence of distant metastasis signifies disease progression and is associated with reduced survival rates [@Park]. Initial spread of cancer cells are localized, then become regional, involving nearby lymph nodes and the most severe cases comprises expansion to other organs such as the brain, liver and bones. As cancer cells metastasize to distant sites, survival prospects diminish drastically [@Markman]. Additionally, patients with no regional lymph node metastases, and smaller tumors are easier to be treated and thus are associated with improved survival rates [@Zhang]. Lymph node involvement is a crucial factor in guiding treatment options. The authors of a study also noted that disease burden and anatomical location of the lymph nodes involved may influence the patients survival [@Kai]. 

Following tumor size, LN involvement and presence of distant metastasis categorization, the pathologic stage of the cancer is then determined, the most valuable prognostic factor in non-small cell lung cancer [@Eldridge]. Stages ranging from localized to distant spread dictate treatment strategies and prognosis, with curative options diminishing as the disease advances (see @sec-appendix for staging). Despite advancements in treatment modalities such as radiation therapy and chemotherapy, stage IV disease remains particularly challenging, emphasizing the importance of early detection and intervention [@Denton]. The earlier the cancer is found, that is the lower the pathologic stage, the greater the likelihood curative radiation therapy is an effective treatment [@Eldridge]. 

Radiation therapy is a local treatment, targeting the tumor directly, damaging the DNA within cancer cells with the aim of shrinking the tumor. Pharmaceutical therapy on the other hand is a systemic therapy utilizing drugs to kill and inhibit cancer cell growth. While radiation therapy offers promise in early-stage NSCLC and palliative care, chemotherapy demonstrates efficacy, particularly in advanced stages with lymph node involvement [@Kai]. However, treatment decisions hinge on a delicate balance between therapeutic efficacy and quality of life considerations, particularly in advanced stages where palliative care predominates [@Eldridge].

There is minimal literature looking at post-diagnosis survival rates based on the variables that make up pathologic stage and as well as looking at the effectiveness of the method of treatment. The extent of this disease illustrates the importance of living a healthy lifestyle, undergoing regular screening and development of improved treatment methods. Over the past decade, there has been great improvement of lymph node assessment in cancer patients [@Kai] and experts hope survival rates continue to improve with new therapies as well as treatment approaches [@Markman]. 

The remainder of this paper is structured as follows. In @sec-data, we visualize the exploration of variables constituting the pathologic stage and treatment types. @sec-model, outlines the model employed to analyze the relationship between these variables and the duration of survival post-diagnosis. Moreover, @sec-results offers visual depictions of the study's outcomes. In @sec-discussion, we summarize the primary findings, propose avenues for enhancement, and identify potential areas for future research. Finally in @sec-appendix, we include a detailed definition the staging of each variable. 

# Data {#sec-data}

## Software and R-packages
This project was created using statistical software, `R` [@citeR]. For data cleaning and manipulation, we used the `tidyverse` [@tidyverse] package, which includes `dplyr` [@dplyr], `readr` [@readr]. Specifically, `readr` was employed for efficient reading of rectangular text data, while `dplyr` facilitated data manipulation tasks such as filtering, summarizing, and joining datasets. 
For unit testing dataset, we utilized the `testthat` [@testthat] package. This allowed us to systematically test our functions and ensure that they behaved as expected across various scenarios. 
In our statistical modeling process, we utilized the `rstanarm` [@rstanarm] package for Bayesian applied regression modeling. This package leverages the Stan probabilistic programming language for efficient computation of Bayesian models, allowing us to perform complex regression analyses while incorporating uncertainty. 
To tidy up and summarize mixed effects models, we employed the `broom.mixed` [@broom.mixed] package. This package provides functions to visualize the results of mixed effects models, making it easier to interpret the findings from such analyses. 
For arranging and combining plots in our visualizations, we utilized the `patchwork` [@patchwork] package. This allowed us to seamlessly arrange multiple plots into a single coherent visual representation, facilitating the communication of complex relationships and patterns in the data.
For aesthetic purposes in our visualizations, we employed the `showtext` [@showtext] package. This enabled us to use a wide range of fonts in our plots, enhancing the visual appeal and customization of our graphical outputs.

## Methodology

The data for this study were collected from a comprehensive database comprising 981 lung cancer patients diagnosed between 1991 to 2013 from `Center for Open Science` [@osf], a dataset acquired in Sydney Australia. The dataset included information on patient demographics, clinical characteristics, treatment modalities, and survival outcomes.

### Data Collection
We obtained data on lung cancer patients meeting the following criteria: histologically confirmed lung cancer diagnosis, availability of complete clinical data, treatment-naive patients, single malignancy and located in Australia. Patients with missing or incomplete information were excluded from the analysis. 

### Data Cleaning
After obtaining the dataset, we selected the columns of interest namely; days to death post diagnosis, presence of distant metastasis, lymph node involvement, pathologic stage, tumor size and treatment type. Next, we renamed the columns, giving them meaningful names and excluded the data containing missing values. This left us with a sample of 382 lung cancer patients. Additionally, we converted the days to death column to numeric. Tests where included to ensure accuracy, reliability and validity of the dataset for subsequent analysis and interpretation.

### Data Analysis
Descriptive and inferential statistical analyses were conducted to explore the dataset and derive meaningful insights. These included linear regression modeling, see @sec-model.

## Features
The dataset comprised several key features relevant to lung cancer prognosis, including pathologic stage, presence of distant metastasis, lymph node involvement, tumor size, and treatment type.

### Days to Death

The main feature analyzed in this study is the duration between the date of lung cancer diagnosis and the date of death, referred to as "days to death." This metric serves as a key indicator of patient survival and provides valuable insights into the disease trajectory and prognosis. By examining the distribution of survival times among lung cancer patients post-diagnosis, we aim to characterize the temporal patterns of disease progression and assess the impact of various clinical factors on survival outcomes. Understanding the time course from diagnosis to death is crucial for guiding treatment decisions, predicting patient outcomes, and identifying opportunities for intervention to improve survival rates. Through comprehensive analysis of days to death data, we seek to elucidate the factors influencing patient survival in lung cancer and contribute to the refinement of prognostic models for clinical practice.

@fig-one illustrates the survival curve for lung cancer patients post-diagnosis where frequency is on the y-axis and survival time in days is on the x-axis. There is a clear trend of a decrease in frequency of survival as time increases. Mortality is most abundant 500 days after diagnosis, that is equivalent to about a year and four months. After about 1500 days, just over four years, the trend line plateaus.

@fig-one, the distribution of survival time post-diagnosis suggests that there is a high mortality rate shortly after diagnosis, thus most lung cancer patients die within one year of diagnosis (500 days). There is a steady decline in death and hence incline in survival up until four years (1500 days). The plateau after this indicates that there is a subgroup of patients who survive beyond four years. @sec-results explores which patients had longer survival. 

```{r}
#| warning: false
#| echo: false
#| message: false
#| label: fig-one
#| fig-cap: The histogram shows the distribution of survival time (days_to_death) in lung cancer patients post-diagnosis.

# install.packages
# install.packages("ggplot2")
# install.packages("dplyr")
# install.packages("showtext")
# install.packages("arrow")

# load packages
library(ggplot2)
library(dplyr)
library(showtext)
library(arrow)

### read in data ###
analysis_data <- read_parquet(file = here::here("data/analysis_data/lung_cancer_analysis_data.parquet"))


# Add the desired font (e.g., Patrick Hand)
font_add_google("Patrick Hand", "patrick")

# Set the font for ggplot
showtext_auto()

# Histogram of survival time in days (days_to_death)
ggplot(analysis_data, aes(x = days_to_death)) +
  geom_histogram(binwidth = 50, fill = "forestgreen", color = "black") +
  labs(title = "Distribution of Survival Time Post-Diagnosis",
       x = "Days to Death", y = "Frequency") +
  scale_x_continuous(breaks = seq(0, max(analysis_data$days_to_death),
                                  by = 500)) +  # Set breaks every 500 days
  theme_minimal() +
  theme(
    text = element_text(family = "patrick") # Set font to Patrick Hand
  )


```

### pathologic Stage
Pathologic stage, a critical determinant of lung cancer prognosis, was classified according to the TNM (tumor, lymph node, metastasis) Cancer Staging. As depicted in @fig-two, illustrating the distribution of pathologic stages with pathologic stage on the x-axis and percentage on the y-axis. The distribution of patients varied across different stages, with the highest proportion of patients diagnosed at Stage IB. At this stage, the cancer is still found early however the tumor has regional spread to nearby lymph nodes. Interestingly, at diagnosis, patients had a fairly even spread across the different stages.

### Presence of Distant Metastasis
The presence of distant metastasis, indicative of cancer spread beyond the site of origin to nearby lymph nodes, significantly influences treatment decisions and patient outcomes. @fig-two illustrates the percentage of patients with distant metastasis where the x-axis is the classification and the y-axis is the percentage of patients. The figure indicates that when patients are diagnosed, most are found in category 'M0' having no distant metastasis and thus cancer has not spread beyond the site of origin. We decided to include the classification 'MX', where tumor could not be evaluated as it contained the next largest proportion of patients. If this data was omitted, there would be a large skew in the data. Additionally, category 'M1a' appears to show no data however this can be explained as only 1 out of the 382 patients were classified this way. 

### Lymph Node Involvement
Lymph node involvement is another key prognostic factor in lung cancer, reflecting the extent of disease spread to regional lymph nodes. @fig-two presents the distribution of patients based on lymph node involvement where lymph node involvement is on the x-axis and percentage is on the y-axis. Here, there is a clear trend that as lymph node involvement becomes more severe, the proportion of patients decline. This demonstrates that upon diagnosis, most patients fall under the category 'N0' where there is no regional lymph node metastasis hence cancer has not spread to the lymph nodes. 

### Tumor Size
Tumor size is measured based on the diameter of the primary tumor in lung cancer patients. @fig-two showcases the distribution of patients across different tumor size categories with tumor size on the x-axis and percentage of patients on the y-axis. The highest proportion of patients were categorized as 'T2' where the tumor is between 3 to 5 centimeters in diameter has grown into the inner lining of the lung, possibly leads to swelling and or collapse of the lung. This category was overwhelmingly more prominent than all others by twofold. All other categories were relatively evenly distributed. 


```{r}
#| warning: false
#| echo: false
#| message: false
#| label: fig-two
#| fig-cap: The histogram shows the percentage of lung cancer patients by pathologic stage, presence of distant metastasis, lymph node involvement, tumor size


# install.packages("patchwork")

# load packages
library(ggplot2)
library(dplyr)
library(showtext)
library(arrow)
library(patchwork)

### read in data ###
analysis_data <- read_parquet(file = here::here("data/analysis_data/lung_cancer_analysis_data.parquet"))


# Add the desired font (e.g., Patrick Hand)
font_add_google("Patrick Hand", "patrick")

# Set the font for ggplot
showtext_auto()

# Set overall title and caption
overall_title <- "Percentage of Lung Cancer Patients by:"

# create bar chart for pathologic_stage
pathologic_stage_counts <- analysis_data %>%
  group_by(pathologic_stage) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(pathologic_stage))

# create bar chart for presence_of_distant metastasis 
presence_of_distant_metastasis_counts <- analysis_data %>%
  group_by(presence_of_distant_metastasis) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(presence_of_distant_metastasis))

# Define a minimum height for the bars
min_bar_height <- 0.1  # Adjust as needed based on visibility preference

# create bar chart for lymph node involvement 
lymph_node_involvement_counts <- analysis_data %>%
  group_by(lymph_node_involvement) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(lymph_node_involvement))

# create bar chart for tumor size
tumor_size_counts <- analysis_data %>%
  group_by(tumor_size) %>%
  summarise(count = n ()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  arrange(desc(tumor_size))


# Create subplots for all four plots
plots <- list(
  ggplot(pathologic_stage_counts, aes(x = pathologic_stage, y = percentage)) +
    geom_bar(stat = "identity", fill = "lightpink") +
    labs(title = "Pathologic Stage",
         x = "",
         y = "Percentage") +
    theme_minimal() +
    theme(
      text = element_text(family = "patrick"), # Set font to Patrick Hand
      axis.text.x = element_text(angle = 45, hjust = 1) # Rotate x-axis labels by 45 degrees
    ) +
    scale_y_continuous(breaks = seq(0, max(pathologic_stage_counts$percentage), by = 5)),
  
   ggplot(presence_of_distant_metastasis_counts, aes(x = presence_of_distant_metastasis, y = percentage)) +
    geom_bar(stat = "identity", fill = "gold") +
    labs(title = "Presence of Distant Metastasis",
         x = "",
         y = "") +  # Remove y-axis label 
    theme_minimal() +
    theme(
      text = element_text(family = "patrick"), # Set font to Patrick Hand
      axis.title.y = element_blank(), # Remove y-axis title
    ),

   ggplot(lymph_node_involvement_counts, aes(x = lymph_node_involvement, y = percentage)) +
    geom_bar(stat = "identity", fill = "cyan") +
    labs(title = "Lymph Node Involvement",
         x = "",
         y = "Percentage") +  # Keep y-axis label for this plot
    theme_minimal() +
    theme(
      text = element_text(family = "patrick") # Set font to Patrick Hand
    ) +
    scale_y_continuous(breaks = seq(0, max(lymph_node_involvement_counts$percentage), by = 10)),
  
  ggplot(tumor_size_counts, aes(x = tumor_size, y = percentage)) +
    geom_bar(stat = "identity", fill = "purple") +
    labs(title = "Tumor Size",
         x = "",
         y = "") +  # Remove y-axis label 
    theme_minimal() +
    theme(
      text = element_text(family = "patrick"), # Set font to Patrick Hand
      axis.title.y = element_blank() # Remove y-axis title
    ) + guides(color = guide_legend(title.position = "top", title.vjust = 0.5))  
    # Adjust legend title position
    
) 

# Combine plots using patchwork and set overall title and caption
plots_combined <- wrap_plots(plots, ncol = 2, heights = c(1.2, 1.2)) +
  plot_annotation(
    title = overall_title,
    theme = theme(
      text = element_text(family = "patrick", size = 14),  # Adjust caption size
      plot.caption = element_text(family = "patrick", size = 12, hjust = 0) 
      # Move caption to far right
    )
  )


# Print combined plots
plots_combined


```

### Treatment Type
Treatment type analysis examines the distribution of lung cancer patients based on the type of treatment they received. @fig-three illustrates this distribution, with treatment type on the x-axis and the percentage of patients on the y-axis. Pharmaceutical Therapy and Radiation Therapy were the two primary treatment categories observed. The split between usage of these two treatment types was very minimal with pharmaceutical therapy at 50.3% and radiation therapy at 49.7%. 


```{r}
#| warning: false
#| echo: false
#| message: false
#| label: fig-three
#| fig-cap: The histogram shows the percentage of lung cancer patients by treatment type.

# load packages
library(ggplot2)
library(dplyr)
library(showtext)
library(arrow)

### read in data ###
analysis_data <- read_parquet(file = here::here("data/analysis_data/lung_cancer_analysis_data.parquet"))


# Add the desired font (e.g., Patrick Hand)
font_add_google("Patrick Hand", "patrick")

# Set the font for ggplot
showtext_auto()

# Create bar chart for treatment type with color coding
treatment_type_counts <- analysis_data %>%
  group_by(treatment_type) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count) * 100)

# Define colors for pharmaceutical therapy and radiation therapy
color_palette <- c("Pharmaceutical Therapy, NOS" = "blue", "Radiation Therapy, NOS" = "green")

# Plotting with color coding and percentages
ggplot(treatment_type_counts, aes(x = treatment_type, y = percentage,
                                  fill = treatment_type,
                                  label = paste0(round(percentage, 1), "%"))) +
  geom_bar(stat = "identity", width = 0.7) +  # Increased bin width
  geom_text(aes(label = paste0(round(percentage, 1), "%")), family = "patrick",
            vjust = -0.5, size = 4) +  
  scale_fill_manual(values = color_palette) +
  labs(x = "Treatment Type", y = "Percentage of Patients",
       title = "Distribution of Lung Cancer Patients by Treatment Type") +
  theme_minimal() +
  scale_y_continuous(limits = c(0, 55), breaks = seq(0, 55, by = 5)) +  # Adjusted y-axis range
  theme(text = element_text(family = "patrick", size = 14),
        axis.text.x = element_blank())  # Remove x-axis tick mark labels


```

\newpage

# Model {#sec-model}

## Model set-up

In this section, we aim to predict the survival outcomes of lung cancer patients post-diagnosis with a linear regression model framework. We consider several predictors including pathologic stage, lymph node involvement, presence of distant metastasis, tumor size, and treatment type. We specify the model and subsequently justify its appropriateness for our analysis.

### Model Specifications ###

We employ a linear regression model to predict the number of days from diagnosis to death for each lung cancer patient. The model is defined as follows:
\begin{align*}
y_i \mid \mu_i, \sigma &\sim \text{Normal}(\mu_i, \sigma)
\end{align*}
where:

- $y_i$ represents the number of days from diagnosis to death for patient $i$.
- $\mu_i$ denotes the expected number of days to death for patient $i$.
- $\sigma$ represents the standard deviation of the survival times.

The linear predictor $\mu_i$ is specified as:
\begin{align*}
y_i \mid \mu_i, \sigma &\sim \text{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_{\text{pathologic\_stage}} \times \text{pathologic\_stage}_i \\
&\quad + \beta_{\text{lymph\_node}} \times \text{lymph\_node\_involvement}_i \\
&\quad + \beta_{\text{metastasis}} \times \text{presence\_of\_distant\_metastasis}_i \\
&\quad + \beta_{\text{tumor\_size}} \times \text{tumor\_size}_i \\
&\quad + \beta_{\text{treatment\_type}} \times \text{treatment\_type}_i
\end{align*}
where:

- $\alpha$ represents the intercept term, capturing the baseline number of days to death.
- $\beta$ {\text{pathologic\_stage}}, $\beta$ {\text{lymph\_node}}, $\beta$ {\text{metastasis}}, $\beta$ {\text{tumor\_size}}, $\beta$ {\text{treatment\_type}} are the coefficients associated with each predictor variable.

### Model justification

Linear regression models are most appropriate in predicting continuous outcomes. As survival time is continuous, this model allows us to quantify the relationships between these predictors and survival outcomes, providing valuable insights into the factors influencing the prognosis of lung cancer patients.

#### Response Variable ####

Our variable of interest is survival time in lung cancer patient after they have been diagnosed

We model the survival time ($y_i$) as a continuous variable, reflecting the duration from diagnosis to death for each patient. This continuous characterization is appropriate for capturing the temporal aspect of survival outcomes in medical contexts.

#### Input Variables ####

We consider several clinically relevant predictors including pathologic stage, lymph node involvement, presence of distant metastasis, tumor size, and treatment type. These variables are chosen based on their established associations with lung cancer prognosis, encompassing key aspects of disease severity and treatment strategies.

#### Model Structure #####

The linear regression model relates the expected survival time ($Î¼_i$) to the linear combination of predictor variables, allowing us to quantify the impact of each predictor on the expected duration of survival. This framework facilitates interpretation of the associations between clinical variables and survival outcomes, providing valuable insights for patient prognosis.

#### Parameter Estimation ####

We anticipate that the survival time of lung cancer patients post-diagnosis will be influenced by various clinical factors such as pathologic stage, extent of lymph node involvement, presence of distant metastasis, tumor size, and treatment type. Specifically, we expect that advanced pathologic stages, increased lymph node involvement, presence of distant metastasis, larger tumor sizes, and certain treatment types will be associated with shorter survival times.

We run the model in R [@citeR] estimating the model coefficients ($\alpha$ and $\beta$) using Bayesian inference via the 'stan_glm()' function from the @rstanarm package. This approach leverages Markov Chain Monte Carlo (MCMC) algorithms to obtain posterior distributions for the model parameters, enabling robust estimation of parameter uncertainties and inference on the effects of predictor variables.


# Results {#sec-results}

Our results are summarized in @fig-four, @fig-five, @fig-six and @fig-seven. This analysis investigates lung cancer treatment outcomes given either radiation therapy or pharmaceutical therapy as well as pathologic stage, presence of distant metastasis, lymph node involvement and tumor size. 

## Treatment Type by Pathologic Stage
This scatter plot @fig-four provides a view of how pathologic stage correlates with the time to death among lung cancer patients, differentiated by treatment type. Each dot represents an individual patient, color-coded to represent whether they received pharmaceutical therapy or radiation therapy. On the x-axis we have days to death after diagnosis and on the y-axis we have the pathologic stages. There are considerably fewer patients part of stages I, II, III, and IIB at diagnosis compared to the other ones. As the time from diagnosis to death increases along the x-axis, we observe a general trend downwards in pathologic stage, indicating disease progression over time. The trend lines fitted for each treatment type further highlight this progression, with radiation therapy showing a steeper decline compared to pharmaceutical therapy. 

```{r}
#| warning: false
#| echo: false
#| message: false
#| label: fig-four
#| fig-cap: The scatterplot shows the relationship between pathologic stage, time to death, and treatment type in lung cancer patients post-diagnosis.

# Load required libraries
library(ggplot2)
library(arrow)
library(showtext)

### read in data ###
analysis_data <- read_parquet(file = here::here("data/analysis_data/lung_cancer_analysis_data.parquet"))

# Add the desired font (e.g., Patrick Hand)
font_add_google("Patrick Hand", "patrick")

# Set the font for ggplot
showtext_auto()

# Create a scatter plot with trend lines - pathologic stage vs. time vs. treatment type
# Create scatter plot with trend lines - pathologic stage vs. time vs. treatment type
plot1 <- ggplot(data = analysis_data, aes(x = days_to_death, y = pathologic_stage, color = treatment_type)) +
  geom_point(size = 2.5, alpha = 0.6, shape = 19) +  # Adjusted point size and transparency
  geom_smooth(method = "lm", se = FALSE, aes(group = treatment_type), alpha = 0.3) +  # Adjust trend line transparency
  scale_color_manual(values = c("Pharmaceutical Therapy, NOS" = "blue",
                                "Radiation Therapy, NOS" = "green")) +
  labs(x = "Days to Death", y = "Pathologic Stage", color = "Treatment Type") +
  scale_x_continuous(breaks = seq(0, max(analysis_data$days_to_death), by = 500)) + 
  # Set breaks on x-axis
  theme_minimal() +
  theme(text = element_text(family = "patrick", size = 13),  # Set font to Patrick Hand and increase the size
        legend.position = "bottom", legend.text = element_text(size = 11),
        plot.caption = element_text(hjust = 0, size = 14)) +  # Adjust legend position and text size
  guides(color = guide_legend(title.position = "top", title.vjust = 0.5)) +
  ggtitle("Pathologic Stage vs. Time vs. Treatment Type")  # Title for the plot


# Display the plot
plot1

```

\newpage

## Treatment Type by Presence of Distant Metastasis
In this scatter plot, @fig-five we examine the relationship between the presence of distant metastasis, time to death, and treatment type for lung cancer patients. Similarly to figure above, the dots on the plot represent individual patients, color-coded based on their treatment regimen. Days to death after diagnosis is on the x-axis and on the y-axis we have the degree of the presence of distant metastasis. The majority of patients are diagnosed at classification 'MO' and hence are caught before cancer is spread from the primary site of origin. As patients survival time increases, excluding  category 'MX', there is a decrease in the presence of distant metastasis, denoted by the downward trend in the scatter plot. Patients undergoing pharmaceutical therapy show a sharper decrease in distant metastasis compared to those receiving radiation therapy. 


```{r}
#| warning: false
#| echo: false
#| message: false
#| label: fig-five
#| fig-cap: The scatterplot illustrates the relationship between distant metastasis, time to death, and treatment type in lung cancer patients post-diagnosis.

# Load required libraries
library(ggplot2)
library(arrow)
library(showtext)

### read in data ###
analysis_data <- read_parquet(file = here::here("data/analysis_data/lung_cancer_analysis_data.parquet"))

# Add the desired font (e.g., Patrick Hand)
font_add_google("Patrick Hand", "patrick")

# Set the font for ggplot
showtext_auto()

# Create a scatter plot with trend lines - presence of distant metastasis vs. time vs. treatment type
plot2 <- ggplot(data = analysis_data, aes(x = days_to_death, y = presence_of_distant_metastasis, color = treatment_type)) +
  geom_point(size = 2.5, alpha = 0.6, shape = 19) +  
  geom_smooth(method = "lm", se = FALSE, aes(group = treatment_type),
              alpha = 0.3) +  
  scale_color_manual(values = c("Pharmaceutical Therapy, NOS" = "blue",
                                "Radiation Therapy, NOS" = "green")) +
  labs(x = "Days to Death", y = "Presence of Distant Metastasis",
       color = "Treatment Type") +
  scale_x_continuous(breaks = seq(0, max(analysis_data$days_to_death),
                                  by = 500)) +
  theme_minimal() +
  theme(text = element_text(family = "patrick", size = 13), 
        legend.position = "bottom", legend.text = element_text(size = 11),
        plot.caption = element_text(hjust = 0, size = 14)) +  
  guides(color = guide_legend(title.position = "top", title.vjust = 0.5)) +
  ggtitle("Presence of Distant Metastasis vs. Time vs. Treatment Type")


# Display the plot
plot2
```

\newpage

## Treatment Type by Lymph Node Involvement 
This scatter plot  @fig-six explores the relationship between lymph node involvement, time to death, and treatment type among cancer patients. Like above, each dot symbolizes an individual patient, with colors indicating their treatment type; pharmaceutical therapy or radiation therapy. Days to death is on the x-axis and lymph node involvement classifications are on the y-axis. At diagnosis, most patients are classified under either NO, N1 or N2. As survival time increases, there is an observable decline in lymph node involvement, reflected by the downward trend in the scatter plot. The trend lines further illuminate this pattern, with patients undergoing pharmaceutical therapy exhibiting a slightly steeper decline in lymph node involvement over time compared to those receiving radiation therapy, however this is very minimal and insignificant difference between the two treatment types. 

```{r}
#| warning: false
#| echo: false
#| message: false
#| label: fig-six
#| fig-cap: The scatterplot demonstrates the relationship between lymph node involvement, time to death, and treatment type in lung cancer patients post-diagnosis.

# Load required libraries
library(ggplot2)
library(arrow)
library(showtext)

### read in data ###
analysis_data <- read_parquet(file = here::here("data/analysis_data/lung_cancer_analysis_data.parquet"))

# Add the desired font (e.g., Patrick Hand)
font_add_google("Patrick Hand", "patrick")

# Set the font for ggplot
showtext_auto()

# Create a scatter plot with trend lines - lymph node involvement vs. time vs. treatment type
plot3 <- ggplot(data = analysis_data, aes(x = days_to_death,
                                          y = lymph_node_involvement,
                                          color = treatment_type)) +
  geom_point(size = 2.5, alpha = 0.6, shape = 19) +  
  geom_smooth(method = "lm", se = FALSE, aes(group = treatment_type),
              alpha = 0.3) +  
  scale_color_manual(values = c("Pharmaceutical Therapy, NOS" = "blue",
                                "Radiation Therapy, NOS" = "green")) +
  labs(x = "Days to Death", y = "Lymph Node Involvement",
       color = "Treatment Type") +
  scale_x_continuous(breaks = seq(0, max(analysis_data$days_to_death),
                                  by = 500)) +
  theme_minimal() +
  theme(text = element_text(family = "patrick", size = 13), 
        legend.position = "bottom", legend.text = element_text(size = 11),
        plot.caption = element_text(hjust = 0, size = 14)) +  
  guides(color = guide_legend(title.position = "top", title.vjust = 0.5)) +
  ggtitle("Lymph Node Involvement vs. Time vs. Treatment Type")


# Display the plot
plot3
```

\newpage

## Treatment Type by Tumor Size
In this scatter plot, @fig-seven we investigate the relationship between tumor size, time to death, and treatment type for cancer patients. Each dot on the plot corresponds to an individual patient, categorized by their treatment regimen whether it is pharmaceutical therapy or radiation therapy. The x-axis represents the time from diagnosis until death and the y-axis is comprised of the tumor sizes. At diagnosis most patients are classified with a T2 tumour. As survival time increases, there is a noticeable reduction in tumor size, depicted by the downwards trajectory in the scatter plot. The trend lines further accentuate this trend, with patients undergoing radiation therapy demonstrating a more pronounced decrease in tumor size over time compared to those receiving pharmaceutical therapy. 


```{r}
#| warning: false
#| echo: false
#| message: false
#| label: fig-seven
#| fig-cap: "The scatterplot portrays the relationship between tumor size, time to death, and treatment type in lung cancer patients post-diagnosis."

# Load required libraries
library(ggplot2)
library(arrow)
library(showtext)

### read in data ###
analysis_data <- read_parquet(file = here::here("data/analysis_data/lung_cancer_analysis_data.parquet"))

# Add the desired font (e.g., Patrick Hand)
font_add_google("Patrick Hand", "patrick")

# Set the font for ggplot
showtext_auto()

# Create a scatter plot with trend lines - tumor size vs. time vs. treatment type
plot4 <- ggplot(data = analysis_data, aes(x = days_to_death,
                                          y = tumor_size,
                                          color = treatment_type)) +
  geom_point(size = 2.5, alpha = 0.6, shape = 19) +  
  geom_smooth(method = "lm", se = FALSE, aes(group = treatment_type),
              alpha = 0.3) +  
  scale_color_manual(values = c("Pharmaceutical Therapy, NOS" = "blue",
                                "Radiation Therapy, NOS" = "green")) +
  labs(x = "Days to Death", y = "Tumor Size",
       color = "Treatment Type") +
  scale_x_continuous(breaks = seq(0, max(analysis_data$days_to_death),
                                  by = 500)) +
  theme_minimal() +
  theme(text = element_text(family = "patrick", size = 13), 
        legend.position = "bottom", legend.text = element_text(size = 11),
        plot.caption = element_text(hjust = 0, size = 14)) +  
  guides(color = guide_legend(title.position = "top", title.vjust = 0.5)) +
  ggtitle("Tumor Size vs. Time vs. Treatment Type")

# Display the plot
plot4

```

\newpage

# Discussion {#sec-discussion}
Lung cancer presents significant challenges in oncology, with survival rates influenced by various factors. This study aimed to elucidate the interplay between pathologic stage, treatment modalities, and survival outcomes in lung cancer patients post-diagnosis.

## Survival Dynamics {#sec-first-point}
Eldridge explains that the severity of lung cancer is staged by pathologic stage which is determined by all three presence of distant metastasis, lymph node involvement and tumor size [@Eldridge]. Previous research found that patients with larger tumors and more extensive lymph node involvement are associated with a decrease in survival [@Zhang]. Additionally, greater presence of distant metastasis and thus advanced spread to other organs is shown to lower a patients survival [@Markman]. 
Our analysis revealed compelling associations between various clinical factors and survival times in lung cancer patients. Upon diagnosis, lung cancer patients with more advanced pathologic stages (@fig-four), classification of presence of distant metastasis (@fig-five), higher greater involvement of lymph nodes (@fig-six) and larger tumors (@fig-seven) were all shown to be associated with a shorter survival time. 

## Treatment Efficacy {#sec-second-point}
An intriguing finding from our study was the differential impact of treatment modalities on survival outcomes. It was observed that @fig-four which looked at pathologic stage, demonstrates that patients receiving pharmaceutical therapy tend to exhibit a slower progression in pathologic stage over time, thus linked to having greater survival time compared to those undergoing radiation therapy. As pathologic stage is determined based on presence of distant metastasis, lymph node involvement and tumor size, this means that the main finding is that pharmaceutical therapy is the more effective treatment. In looking at these variables separately however, we see that not all the variables indicate that pharmaceutical therapy is superior. 

Results looking at tumor size @fig-seven, pharmaceutical therapy is associated with slower tumor growth rate and thus pharmaceutical therapy is more potent at treating lung cancer patients, aligning with the results of pathologic stage @fig-four. On the other hand, the plateaued trend line for radiation therapy compared to the sharper decline of pharmaceutical therapy in @fig-five of presence of distant metastasis, this portrays radiation therapy was more effective in prolonging survival. Finally, with lymph node involvement @fig-six, pharmaceutical therapy and radiation therapy are both equally associated with increasing survival time based on lymph node involvement. These nuanced insights underscore the need for tailored treatment strategies based on individual patient characteristics and disease profiles.

## Limitations
Despite the insights gained from our study, several limitations warrant acknowledgment. As mentioned earlier, the data set included 981 patients and after removing patients with incomplete data, we were left with 382 patients. This is a much smaller sample and thus there is a chance of bias and impact validity of our findings. Another area of weakness could be that values for 'MX' presence of distant metastasis and 'NX" lymph node involvement which indicate cases that could not be assed, these were left in the data set as to not decrease the sample size anymore. It likely that had these been taken out, the results would be different. We made the executive decision to include these values as reasons for inability to be assessed could be because the spread was too small to be detected. Additionally, our study did not account for certain variables such as performance status, smoking status, and genetic mutations, which may influence treatment responses and survival outcomes. Another limitation is that this study treatment types were pharmaceutical and radiation treatment individually. In previous studies, pharmaceutical treatment is often used in combination with radiation therapy to treat lung cancer as its shown better results in destroying cancer cells. In some patients, pharmaceutical therapy ensures the tumor remains small in size and the radiation destroys the cancer.  

## Future Directions
The data set we used also offered information regarding demographics such as race, gender and year of birth. It would have been interesting to explore whether the treatment type and success would have been affected by these demographics. For example, radiation oncologists are looking into gender-dependent radiation therapies and are finding that female patients are more curative however they portray more side effects. Future research efforts should aim to address these gaps and explore the role of novel treatment modalities, biomarkers, and personalized medicine approaches in improving lung cancer prognosis.

# Conclusion {#sec-conclusion}
In conclusion, our study provides valuable insights into the complex factors influencing survival outcomes in lung cancer patients post-diagnosis. By elucidating the relationships between pathologic stage, treatment modalities, and survival times, we aim to inform clinical practice and guide future research endeavors. Although we established a general trend for those more likely to survive longer post-diagnosis, it's important to note that no two lung cancer patients are the same due to gene mutations present in the tumor and thus survival will vary person to person [@Eldridge]. Additionally, treatments are constantly improving and changing. Ultimately, our collective efforts must continue to focus on advancing early detection methods, refining treatment strategies, and enhancing the quality of care for lung cancer patients worldwide.


\newpage

\appendix

# Appendix {#sec-appendix}

### Pathologic Stage ###
Note: Stage is determined by tumor size, number of tumors found and where
  the cancer has spread. Includes having tumors in both lungs, no matter the size of the tumors.
  
Stage I: cancer is found early, is in one lung, has not spread to LN. Localized

Stage II: found early but has spread inside or just outside of one lung
  and may have spread to nearby LN on same side of the body. Regional spread.
  
Stage III: cancer found in one lung and has spread to the chest and LN
  further away from the lungs. Regional spread.
  
Stage IV: advanced cancer and has spread to the lining or fluid around 
  the heart or lungs, or has spread to distant parts of the body. 


### Tumor size ###
TX: size cannot be assessed - too small for testing

T1: <3cm diameter, only in lungs 

T1a: <1cm, have not reached tissues surrounding lung/main branches of the
  airways
  
T1b: 1-2cm, have not reached tissues surrounding lung/main branches of the
  airways
  
T2: 3-5cm, grown into main bronchus/inner lining of lungs or caused lung 
  collapse or swelling. 
  
T2a: 3-4cm, grown into main airways and/or tissue around the lungs

T2b: 4-5cm, grown into main airways and/or tissue around the lungs

T3: 5-7cm, growth beyond primary site, into chest wall/ nearby site or
  other tumors in the same lobe of the lung
  
T4: >7cm, extensive tumor growth, invading nearby structures/organs. Growth
  into center of chest, to the diaphragm, heart or its major blood vessels,
  windpipe, esophagus, spine or other tumors in same lobe of the lung
  
### Presence of distant metastasis ###
MX: not evaluated 

M0: no distant metastasis, cancer not spread beyond site of origin/ nearby LN. Localized.
  
M1a: presence of metastasis to distant sites within the same lung/pleura. Regional.
  
M1b: metastasis to distant sites beyond lung and pleura, ex. brain, liver, bones. Distant. 
  
### Lymph Node (LN) involvement ###
NX: LN cannot be assessed

N0: no regional LN metastasis, cancer not spread to LN

N1: involvement of regional LN

N2: more extensive LN involvement


### Treatment type ###
Pharmaceutical therapy 

Radiation Therapy


\newpage

# References


